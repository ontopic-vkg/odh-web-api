title="Constract queries"

[accommodation]
name="accommodation"
query="""
BASE <http://noi.example.org/data/accommodation/>
PREFIX schema: <http://schema.org/>
 CONSTRUCT {
   ?newH a ?cl ; schema:name ?nameStr ; schema:description ?descStr ;  schema:image ?imageurltoshow ; schema:email ?email ;
     schema:address [
    a schema:PostalAddress ; schema:name ?aNameStr ; schema:alternateName ?aAltNameStr;
    schema:addressRegion ?province; schema:addressCountry ?country; schema:email ?email ;  schema:faxNumber ?aFax; schema:telephone ?aTelephone ] .

 }
 WHERE {
   # Show the @id property in Json LD default value true
   BIND (!(COALESCE(?showid, "true") = "false") AS ?bShowId)

   BIND (IRI(?Id) AS ?h)
   BIND (COALESCE(?idtoshow, IRI(CONCAT("http://service.suedtirol.info/api/Accommodation/", ?Id)))  AS ?defaultH)
   BIND (IF(?bShowId, ?defaultH, BNODE()) AS ?newH)
   BIND (IF(?language = "ru" || ?language = "fr" || ?language = "pl" || ?language = "cs" || ?language = "de" || ?language = "nl" || ?language = "it"
   , ?language, "en") AS  ?normalizedLanguage )

   VALUES (?province ?normalizedLanguage ) {
   ("Südtirol - Alto Adige" "en")
   ("Alto Adige" "it")
   ("Южный Тирол" "ru")
   ("Sud-Tyrol" "fr")
   ("Południowy Tyrol" "pl")
   ("Itálie" "cs")
   ("Italien" "de")
   ("Italië" "nl")
   }

   VALUES (?country ?normalizedLanguage ) {
      ("Italia" "it")
      ("Italy" "en")
      ("Италия" "ru")
      ("Italie" "fr")
      ("Włochy" "pl")
      ("Jižní Tyrolsko" "cs")
      ("Südtirol" "de")
      ("Südtirol" "nl")
      }

#   BIND (IRI(CONCAT("http://noi.example.org/data/gastronomy/", ?Id)) AS ?gastronomy)

   ?h a schema:LodgingBusiness ;
   schema:address ?a .
   ?a a schema:PostalAddress .

     # if  language exist use it
    OPTIONAL {
       ?h schema:name ?name .
        FILTER (?language = lang(?name)  && ?language != "en")
#        FILTER (langMatches ( lang(?name), ?language))
     }

    # if  language does not exist use english
     OPTIONAL {
      ?h schema:name ?name .
        FILTER ("en" = lang(?name))
#     FILTER (langMatches ( lang(?nameLan), "en"))
    }

   OPTIONAL {
     ?h schema:description ?desc .
     FILTER (?language = lang(?desc) && ?language != "en" )
   }
   OPTIONAL {
    ?h schema:description ?desc .
    FILTER ("en" = lang(?desc))
  }

#   OPTIONAL {
#     ?gastronomy schema:url ?url .
#   }

    OPTIONAL {
        ?h schema:image ?imageurltoshow .
     }

    OPTIONAL {
        ?h schema:email ?email .
     }

   OPTIONAL {
          ?a schema:name ?aName .
           FILTER (?language = lang(?aName)  && ?language != "en")
        }

        OPTIONAL {
         ?a schema:name ?aName .
           FILTER ("en" = lang(?aName))
       }

   OPTIONAL {
     ?a schema:alternateName ?aAltNameLan .
     FILTER (?language  = lang(?aAltNameLan))
   }
     OPTIONAL {
       ?a schema:alternateName ?aAltNameEn .
       FILTER ("en" = lang(?descEn))
     }
     BIND(COALESCE(?aAltNameLan, ?aAltNameEn) as ?aAltName)

    OPTIONAL {
     ?a schema:email ?aEmail .
   }

   OPTIONAL {
        ?a  schema:faxNumber ?aFax .
      }

   OPTIONAL {
          ?a schema:telephone ?aTelephone .
   }


   OPTIONAL {
     ?h a schema:Hotel .
     BIND (schema:Hotel AS ?c)
   }
   OPTIONAL {
     ?h a schema:Campground .
     BIND (schema:Campground AS ?c)
   }
   OPTIONAL {
     ?h a schema:BedAndBreakfast .
     BIND (schema:BedAndBreakfast AS ?c)
   }
   OPTIONAL {
     ?h a schema:Hostel .
     BIND (schema:Hostel AS ?c)
   }
   BIND (COALESCE(?c, schema:LodgingBusiness) AS ?cl)

   BIND(str(?name) AS ?nameStr)
   BIND(str(?desc) AS ?descStr)
   BIND(str(?aAltName) AS ?aAltNameStr)
   BIND(str(?aName) AS ?anameStr)


 }
"""
